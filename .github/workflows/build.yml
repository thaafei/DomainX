name: Manually Build PDF

on:
  workflow_dispatch:
    inputs:
      pdf_path:
        description: "The path to the pdf, not including the docs/ and file extension. For example: SRS-Volere/SRS"
        required: true
        type: string

env:
  FILE: ${{ inputs.pdf_path }}

jobs:
  update-pdfs:
    runs-on: ubuntu-latest
    if: ${{ inputs.pdf_path }}
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Commit message
        id: commit-message
        run: |
          COMMIT_MESSAGE="Add/Update pdf ${{ env.FILE }}"
          echo "COMMIT_MESSAGE=$COMMIT_MESSAGE" >> $GITHUB_ENV
          echo "COMMIT_MESSAGE=$COMMIT_MESSAGE" >> $GITHUB_OUTPUT

      - name: Install TeX Live and make
        run: |
          apt-get update
          apt-get install -y exlive-latex-extra make

      - name: Compile LaTeX Files
        run: |
          cd docs
          file="${{ env.FILE }}"
          dir=$(dirname "$file" | cut -d'/' -f2-)
          make -B "$dir/$(basename "$file" .tex).pdf"

      - name: Verify generated PDFs
        run: ls -R docs

      - name: Commit and push PDFs
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: ${{ steps.commit-message.outputs.COMMIT_MESSAGE }}
          file_pattern: 'docs/**/*.pdf'
          branch: ${{ github.head_ref || github.ref_name }}
